<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kh.quali.takenQualiExam.model.dao.TakenQualiExamMapper">

	<resultMap id="takenQualiExam" type="takenQualiExam">
		<id column="EXAM_NO" property="examNo" />
	    <result column="EXAM_START_DATE" property="examStartDate" />
	    <result column="EXAM_FINAL_DATE" property="examFinalDate" />
	    <result column="RECEPTION_START_DATE" property="receptionStartDate" />
	    <result column="RECEPTION_END_DATE" property="receptionEndDate" />
	    <result column="OPINION_START_DATE" property="opinionStartDate" />
	    <result column="OPINION_END_DATE" property="opinionEndDate" />
	    <collection property="qualificationExam" ofType="techQualificationExam">
	    	<id column="EXAM_TYPE_NO" property="examTypeNo" />
    		<result column="QUALIFICATION_RANK" property="qualificationRank" />
    		<collection property="technicalQualification" ofType="technicalQualification">
    			<id column="QUALIFICATION_NO" property="qualificationNo"/>
				<result column="QUALIFICATION_NAME" property="qualificationName"/>
				<result column="STATUS" property="status"/>
				<result column="REQUIRED_RANK" property="requiredRank"/>
				<collection property="techCategory" ofType="techCategory">
					<id column="CATEGORY_NO" property="categoryNo"/>
					<result column="CATEGORY_NAME" property="categoryName"/>
					<collection property="technicalField" ofType="technicalField">
						<id column="FIELD_NO" property="fieldNo"/>
						<result column="FIELD_NAME" property="fieldName"/>
						<collection property="typeQualification" ofType="typeQualification">
							<id column="QUALIFICATION_CODE" property="qualificationCode"/>
							<result column="QUALIFICATION_TYPE" property="qualificationType"/>
						</collection>
					</collection>
				</collection>
    		</collection>
	    </collection>
	</resultMap>
	
	<resultMap id="techQualificationExam" type="techQualificationExam">
    	<id column="EXAM_TYPE_NO" property="examTypeNo" />
   		<result column="QUALIFICATION_RANK" property="qualificationRank" />
   		<collection property="technicalQualification" ofType="technicalQualification">
   			<id column="QUALIFICATION_NO" property="qualificationNo"/>
			<result column="QUALIFICATION_NAME" property="qualificationName"/>
			<result column="STATUS" property="status"/>
			<result column="REQUIRED_RANK" property="requiredRank"/>
			<collection property="techCategory" ofType="techCategory">
				<id column="CATEGORY_NO" property="categoryNo"/>
				<result column="CATEGORY_NAME" property="categoryName"/>
				<collection property="technicalField" ofType="technicalField">
					<id column="FIELD_NO" property="fieldNo"/>
					<result column="FIELD_NAME" property="fieldName"/>
					<collection property="typeQualification" ofType="typeQualification">
						<id column="QUALIFICATION_CODE" property="qualificationCode"/>
						<result column="QUALIFICATION_TYPE" property="qualificationType"/>
					</collection>
				</collection>
			</collection>
   		</collection>
	</resultMap>
	
	<select id="findTechExamNoByNameAndRank" parameterType="techQualificationExam" resultMap="techQualificationExam">
	SELECT EXAM_TYPE_NO, 
	QUALIFICATION_RANK, 
    TB_QUALIFICATION_EXAM.QUALIFICATION_NO,
    QUALIFICATION_NAME, 
    STATUS, 
    REQUIRED_RANK, 
    TB_QUALI_TECH_CATEGORY.CATEGORY_NO, 
    TB_QUALI_TECH_CATEGORY.CATEGORY_NAME, 
    TB_QUALI_TECHNICAL_FIELD.FIELD_NO, 
    TB_QUALI_TECHNICAL_FIELD.FIELD_NAME, 
    TB_TYPE_QUALIFICATION.QUALIFICATION_CODE, 
    QUALIFICATION_TYPE 
    FROM TB_QUALIFICATION_EXAM JOIN TB_TECHNICAL_QUALIFICATION ON (TB_TECHNICAL_QUALIFICATION.QUALIFICATION_NO = TB_QUALIFICATION_EXAM.QUALIFICATION_NO) 
    JOIN TB_QUALI_TECH_CATEGORY ON (TB_QUALI_TECH_CATEGORY.CATEGORY_NO = TB_QUALI_TECH_CATEGORY.CATEGORY_NO) 
    JOIN TB_QUALI_TECHNICAL_FIELD ON (TB_QUALI_TECHNICAL_FIELD.FIELD_NO = TB_QUALI_TECH_CATEGORY.FIELD_NO) 
    JOIN TB_TYPE_QUALIFICATION ON (TB_TYPE_QUALIFICATION.QUALIFICATION_CODE = TB_QUALI_TECHNICAL_FIELD.QUALIFICATION_CODE)
    WHERE QUALIFICATION_RANK = #{qualificationRank} 
    AND TB_QUALIFICATION_EXAM.QUALIFICATION_NO = #{technicalQualification.qualificationNo}
	</select>
	
</mapper>